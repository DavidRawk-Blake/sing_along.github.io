<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sing Along</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="outside-notes">
    <div class="floating-note">ğŸµ</div>
    <div class="floating-note">ğŸ¶</div>
    <div class="floating-note">â™ª</div>
    <div class="floating-note">â™«</div>
    <div class="floating-note">ğŸ¼</div>
    <div class="floating-note">â™¬</div>
    <div class="floating-note">ğŸ¤</div>
    <div class="floating-note">ğŸ§</div>
  </div>

  <div class="kids-frame-container">
    <div class="wavy-purple-frame">
      <div class="wavy-border"></div>
      <div class="grass-field">
        
      </div>

      <div class="frame-content">
        <h1>ğŸ¼ Lets Sing Along ğŸ¼</h1>

        <div class="fun-decorations">
          <div class="musical-note">ğŸµ</div>
          <div class="musical-note">ğŸ¶</div>
          <div class="musical-note">â™ª</div>
          <div class="musical-note">â™«</div>
          <div class="hearts">ğŸ’œ</div>
          <div class="hearts">ğŸ’–</div>
        </div>
        <p>This is a super cool wavy purple picture frame that looks like it was made just for kids! The wiggly borders
          and fun colors make everything inside look extra special! ğŸµğŸ¨</p>
        <p style="font-size: 0.9em; transform: rotate(-1deg);">
          Put your favorite drawings, photos, or messages in here! ğŸ–ï¸ğŸ“¸ğŸ¶
        </p>

        <!-- Lyrics Display Area -->
        <div class="lyrics-container">
          <div id="sentenceDisplay" class="sentence-display">
            Click "Play" to begin your sing-along experience! ğŸ¤
          </div>
          <div class="progress-container">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>

        <div class="media-controls">
          <button id="playBtn" class="control-button play-button" onclick="playAction()" title="Play">â–¶</button>
          <button id="pauseBtn" class="control-button pause-button" onclick="pauseAction()" title="Pause">â¸</button>
          <button id="restartBtn" class="control-button restart-button" onclick="restartAction()" title="Restart">â®</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio elements with native controls (hidden) -->
  <div class="audio-section" style="display: none;">
    <h3>ğŸµ Audio Tracks</h3>
    <div class="audio-player">
      <label for="song1">Song 1:</label>
      <audio id="song1" controls preload="auto">
        <source src="song1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
    <div class="audio-player">
      <label for="song2">Song 2:</label>
      <audio id="song2" controls preload="auto">
        <source src="song2.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
  </div>


</body>

<script src="lyrics-engine.js"></script>
<script>
  // Audio control functionality for the musical picture frame
  // Global variables for audio elements and lyrics
  let song1, song2;
  let lyricsEngine;
  let isPlaying = false;
  let startTime = 0;
  let animationFrame = null;

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', function () {
    // Get references to audio elements
    song1 = document.getElementById('song1');
    song2 = document.getElementById('song2');

    // Initialize lyrics engine
    lyricsEngine = new LyricsEngine();
    lyricsEngine.initialize({
      sentenceDisplay: document.getElementById('sentenceDisplay'),
      progressFill: document.getElementById('progressFill'),
      audioPlayer: song1 // Use song1 as primary for timing
    });

    // Reset when songs end
    song1.addEventListener('ended', () => {
      song1.currentTime = 0;
      console.log('Song1 ended and reset to beginning');
    });

    song2.addEventListener('ended', () => {
      song2.currentTime = 0;
      console.log('Song2 ended and reset to beginning');
    });

    // Add pressed effect to buttons on mouse/touch events
    const buttons = [document.getElementById('playBtn'), document.getElementById('pauseBtn'), document.getElementById('restartBtn')];
    buttons.forEach(button => {
      // Handle mouse events
      button.addEventListener('mousedown', () => addPressedEffect(button));
      // Handle touch events for mobile devices
      button.addEventListener('touchstart', () => addPressedEffect(button), { passive: true });
    });

    console.log('Audio controls initialized after DOM loaded');
  });

  // Lyrics animation loop
  function animateLyrics() {
    if (!isPlaying) return;

    const currentTime = song1.currentTime || (Date.now() - startTime) / 1000;
    
    // Find current sentence using lyrics engine
    let sentenceIndex = lyricsEngine.findCurrentSentenceIndex(currentTime);
    
    if (sentenceIndex === -1 && lyricsEngine.isSongFinished(currentTime)) {
      // Song finished
      stopLyrics();
      return;
    }

    if (sentenceIndex !== -1) {
      lyricsEngine.updateState({ currentSentenceIndex: sentenceIndex });
      lyricsEngine.displaySentence(sentenceIndex, currentTime);
    }
    
    lyricsEngine.updateProgress(currentTime);
    animationFrame = requestAnimationFrame(animateLyrics);
  }

  // Start lyrics display
  function startLyrics() {
    isPlaying = true;
    startTime = Date.now();
    lyricsEngine.updateState({ isPlaying: true, currentSentenceIndex: 0 });
    animateLyrics();
  }

  // Pause lyrics display
  function pauseLyrics() {
    isPlaying = false;
    lyricsEngine.updateState({ isPlaying: false });
    if (animationFrame) {
      cancelAnimationFrame(animationFrame);
    }
  }

  // Stop and reset lyrics display
  function stopLyrics() {
    isPlaying = false;
    lyricsEngine.reset();
    if (animationFrame) {
      cancelAnimationFrame(animationFrame);
    }
  }

  // Global functions for onclick handlers
  function playAction() {
    console.log('Playing both songs simultaneously with lyrics');
    song1.play().catch(e => console.log('Song1 play error:', e));
    song2.play().catch(e => console.log('Song2 play error:', e));
    startLyrics();
    addPressedEffect(document.getElementById('playBtn'));
  }

  function pauseAction() {
    console.log('Paused both songs and lyrics');
    song1.pause();
    song2.pause();
    pauseLyrics();
    addPressedEffect(document.getElementById('pauseBtn'));
  }

  function restartAction() {
    console.log('Stopped and reset both songs and lyrics');
    song1.pause();
    song2.pause();
    song1.currentTime = 0;
    song2.currentTime = 0;
    stopLyrics();
    addPressedEffect(document.getElementById('restartBtn'));
  }

  // Add pressed effect functionality for better visual feedback
  function addPressedEffect(button) {
    button.classList.add('pressed');

    // Remove pressed class after short delay
    setTimeout(() => {
      button.classList.remove('pressed');
    }, 150);
  }
</script>

</html>